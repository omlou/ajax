{"version":3,"file":"ajax.min.js","sources":["../../node_modules/@xlou/webtools/dist/es/webtools.min.js","../../src/index.ts","../../src/index.umd.ts"],"sourcesContent":["const e=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",t={encode:function(t){let r,n,o,i,a,f,l,c=\"\",d=0;for(t=function(e){e=e.replace(/\\r\\n/g,\"\\n\");let t=\"\";for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}(t);d<t.length;)r=t.charCodeAt(d++),n=t.charCodeAt(d++),o=t.charCodeAt(d++),i=r>>2,a=(3&r)<<4|n>>4,f=(15&n)<<2|o>>6,l=63&o,isNaN(n)?f=l=64:isNaN(o)&&(l=64),c=c+e.charAt(i)+e.charAt(a)+e.charAt(f)+e.charAt(l);return c},decode:function(t){let r,n,o,i,a,f,l,c=\"\",d=0;for(t=t.replace(/[^A-Za-z0-9\\+\\/\\=]/g,\"\");d<t.length;)i=e.indexOf(t.charAt(d++)),a=e.indexOf(t.charAt(d++)),f=e.indexOf(t.charAt(d++)),l=e.indexOf(t.charAt(d++)),r=i<<2|a>>4,n=(15&a)<<4|f>>2,o=(3&f)<<6|l,c+=String.fromCharCode(r),64!=f&&(c+=String.fromCharCode(n)),64!=l&&(c+=String.fromCharCode(o));return c=function(e){let t=\"\",r=0,n=0,o=0,i=0;for(;r<e.length;)n=e.charCodeAt(r),n<128?(t+=String.fromCharCode(n),r++):n>191&&n<224?(o=e.charCodeAt(r+1),t+=String.fromCharCode((31&n)<<6|63&o),r+=2):(o=e.charCodeAt(r+1),i=e.charCodeAt(r+2),t+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&i),r+=3);return t}(c).replace(/\\u0000/g,\"\"),c}};function r(e,t=new Set){if(\"object\"!=typeof e||null===e)return e;if(t.has(e))return e;let n;switch(t.add(e),e.constructor){case Array:n=[];for(let o of e)n.push(r(o,t));break;case Set:n=new Set,e.forEach((e=>{n.add(r(e,t))}));break;case Map:n=new Map,e.forEach(((e,o)=>{n.set(r(o,t),r(e,t))}));break;default:n={};for(let o in e)n[o]=r(e[o],t)}return n}function n(e,t,r){let n={};if(!t)return Object.assign(n,e);let o=t.split(\",\");if(void 0===r&&(r=!0),r)for(let t of o)t=t.trim(),e[t]&&(n[t]=e[t]);else{Object.assign(n,e);for(let e of o)delete n[e]}return n}function o(e=window.location.href){let t={},r=e.indexOf(\"?\");if(-1===r)return t;let n=e.indexOf(\"#\");(-1===n||r>n)&&(n=void 0);let o=e.slice(r+1,n);if(\"\"===o)return t;let i=o.split(\"&\");for(let e of i){if(!e)continue;let r=e.split(\"=\");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||\"\")}return t}function i(e,t=!1){let r=[];for(let t in e)null!==e[t]&&void 0!==e[t]||(e[t]=\"\"),r.push(encodeURIComponent(t)+\"=\"+encodeURIComponent(e[t]));let n=r.join(\"&\");return n&&t?\"?\"+n:n}function a(e,t){if(void 0===e)return;let r=Number(e);if(isNaN(r))throw\"argument for toFixed error\";if(r>Math.pow(10,21))return String(r);let n=Number(t);if(void 0===t||0==n)return String(Math.round(r));if(isNaN(n))throw\"The argument of C.toFixed must be a number\";if(n>20||n<0)throw\"The second argument of C.toFixed must be between 0 and 20\";let o=String(r),i=o.split(\".\");if(i.length<2){o+=\".\";for(let e=0;e<n;e++)o+=\"0\";return o}let a=i[0],f=i[1];if(f.length==n)return o;if(f.length<n){for(let e=0;e<n-f.length;e++)o+=\"0\";return o}o=a+\".\"+f.slice(0,n);let l=f.slice(n,n+1);if(parseInt(l,10)>=5){let e=10**n;o=(parseFloat(o)*e+1)/e,o=o.toFixed(n)}return o}function f(e){const{document:t}=window,r=t.createElement(\"form\"),{data:n}=e;delete e.data;for(let t in e)e[t]&&(r[t]=e[t]);r.style.display=\"none\";for(let e in n){const o=t.createElement(\"input\");o.setAttribute(\"type\",\"hidden\"),o.setAttribute(\"name\",e),o.value=n[e],r.appendChild(o)}t.body.appendChild(r),r.submit()}function l(e){return new Promise(((t,r)=>{const n=new XMLHttpRequest;n.onload=e=>{t(n.response)},n.onerror=e=>{r(e)},n.open(\"GET\",e,!0),n.send()}))}function c(e){return new Promise(((t,r)=>{const n=new XMLHttpRequest;n.onload=e=>{t(JSON.parse(n.response))},n.onerror=e=>{r(e)},n.open(\"GET\",e,!0),n.send()}))}function d(e){let t=localStorage.getItem(e);if(\"string\"==typeof t)try{t=JSON.parse(t)}catch(e){}return t}function u(e,t){if(\"object\"==typeof t&&null!==t)try{t=JSON.stringify(t)}catch(e){}localStorage.setItem(e,t)}function s(){return Math.floor(1e14*Math.random()).toString(36)+Date.now().toString(36)}function h(e){let t=e.toLowerCase(),r=[];if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){let e=\"#\";for(let r=1;r<4;r+=1)e+=t.slice(r,r+1).concat(t.slice(r,r+1));t=e}for(let e=1;e<7;e+=2)r.push(parseInt(\"0x\"+t.slice(e,e+2)));return r}if(/^(rgb\\(|RGB\\()[\\s\\S]+\\)/.test(t))return r=t.replace(/( |\\(|\\)|rgb|RGB)+/g,\"\").split(\",\"),r.map(Number)}var g={Base64:t,deepCopy:r,filterObject:n,getQuery:o,queryString:i,toFixed:a,formSubmit:f,readText:l,readJSON:c,getStore:d,setStore:u,unid:s,colorRGB:h};export{t as Base64,h as colorRGB,r as deepCopy,g as default,n as filterObject,f as formSubmit,o as getQuery,d as getStore,i as queryString,c as readJSON,l as readText,u as setStore,a as toFixed,s as unid};\n//# sourceMappingURL=webtools.min.js.map\n","import { queryString } from '@xlou/webtools';\nvar ResType;\n(function (ResType) {\n    ResType[\"DF\"] = \"\";\n    ResType[\"AB\"] = \"arraybuffer\";\n    ResType[\"Blob\"] = \"blob\";\n    ResType[\"DOC\"] = \"document\";\n    ResType[\"JSON\"] = \"json\";\n    ResType[\"TXT\"] = \"text\";\n})(ResType || (ResType = {}));\nvar ContentType;\n(function (ContentType) {\n    ContentType[\"json\"] = \"application/json;charset=UTF-8\";\n    ContentType[\"urlencoded\"] = \"application/x-www-form-urlencoded;charset=UTF-8\";\n    ContentType[\"formData\"] = \"multipart/form-data\";\n    ContentType[\"text\"] = \"text/plain;charset=UTF-8\";\n    ContentType[\"xml\"] = \"application/xml;charset=UTF-8\";\n    ContentType[\"stream\"] = \"application/octet-stream\";\n})(ContentType || (ContentType = {}));\nconst bodySet = new Set([\n    '[object String]',\n    '[object FormData]',\n    '[object Blob]',\n    '[object ArrayBuffer]',\n    '[object URLSearchParams]',\n    '[object Null]',\n    '[object Undefined]'\n]);\n/* 将对象转换为可拼接在 URL 后的参数 */\nfunction getUrlParam(url, data) {\n    if (!data) {\n        return \"\";\n    }\n    let paramsString = typeof data === \"string\" ? data : queryString(data);\n    if (!paramsString)\n        return \"\";\n    return url.indexOf('?') !== -1 ? ('&' + paramsString) : ('?' + paramsString);\n}\n/* 转换 POST 请求的 body 参数 */\nfunction convertData(data, type, xhr) {\n    if (bodySet.has(Object.prototype.toString.call(data))) {\n        return data;\n    }\n    if (type) {\n        if (type.includes(\"application/json\")) {\n            data = JSON.stringify(data);\n        }\n        else if (type.includes(\"application/x-www-form-urlencoded\")) {\n            data = queryString(data);\n        }\n        else if (type.includes(\"multipart/form-data\")) {\n            const formData = new FormData();\n            for (let i in data) {\n                formData.append(i, data[i]);\n            }\n            data = formData;\n        }\n    }\n    else {\n        xhr.setRequestHeader(\"Content-Type\", ContentType.json);\n        data = JSON.stringify(data);\n    }\n    return data;\n}\n/* 获取返回头参数 */\nfunction getHeaders(arg) {\n    const headers = {};\n    if (arg !== null) {\n        const arr = arg.trim().split(/[\\r\\n]+/);\n        for (const item of arr) {\n            const parts = item.split(\": \");\n            headers[parts[0]] = parts[1];\n        }\n    }\n    return headers;\n}\n/* 判断请求是否成功 */\nfunction getOk(status) {\n    return status >= 200 && status <= 299;\n}\nconst ajax = function (args) {\n    return new Promise(function (resolve, reject) {\n        const xhr = new XMLHttpRequest();\n        /* 监听请求成功返回结果 */\n        xhr.addEventListener('load', ev => {\n            console.log(\"load\", ev, xhr);\n            const headers = getHeaders(xhr.getAllResponseHeaders());\n            const ajaxRequest = {\n                request: xhr,\n                config: args,\n                headers,\n                response: xhr.response,\n                status: xhr.status,\n                statusText: xhr.statusText\n            };\n            if (getOk(xhr.status)) {\n                resolve(ajaxRequest);\n            }\n            else {\n                reject(ajaxRequest);\n            }\n        });\n        /* 监听请求发生错误 */\n        xhr.addEventListener('error', ev => {\n            console.log(\"error\", ev, xhr);\n            reject(ev);\n        });\n        /* 监听请求超时 */\n        xhr.addEventListener('timeout', ev => {\n            console.log(\"timeout\", ev, xhr);\n            reject(ev);\n        });\n        /* 添加上传进度的监听 */\n        if (args.uploadProgress) {\n            xhr.upload.addEventListener('loadstart', ev => {\n                args.uploadProgress(ev);\n            });\n            xhr.upload.addEventListener('progress', ev => {\n                args.uploadProgress(ev);\n            });\n            xhr.upload.addEventListener('load', ev => {\n                args.uploadProgress(ev);\n            });\n            xhr.upload.addEventListener('loadend', ev => {\n                args.uploadProgress(ev);\n            });\n            xhr.upload.addEventListener('error', ev => {\n                args.uploadProgress(ev);\n            });\n        }\n        /* 添加下载监听 */\n        if (args.downloadProgress) {\n            xhr.addEventListener('loadstart', ev => {\n                args.downloadProgress(ev);\n            });\n            xhr.addEventListener('progress', ev => {\n                args.downloadProgress(ev);\n            });\n            xhr.addEventListener('loadend', ev => {\n                args.downloadProgress(ev);\n            });\n        }\n        /* 处理请求参数 */\n        let { method, url, params, data, headers, timeout, responseType, withCredentials } = args;\n        /* 处理 method */\n        method = method ? method.toUpperCase() : \"GET\";\n        let simrequ = false;\n        if (new Set(['GET', 'DELETE', 'HEAD', 'OPTIONS', 'TRACE']).has(method)) {\n            simrequ = true;\n        }\n        /* 处理 url */\n        if (params) {\n            url += getUrlParam(url, params);\n        }\n        /* 开启请求 */\n        xhr.open(method, url, true);\n        console.log(xhr);\n        /* 处理 withCredentials ，该参数控制请求是否支持携带 cookie */\n        if (withCredentials !== undefined) {\n            xhr.withCredentials = withCredentials;\n        }\n        /* 处理 responseType */\n        xhr.responseType = responseType || ResType.JSON;\n        /* 处理 headers ，并根据 Content-Type 处理 data 数据 */\n        if (headers) {\n            let type = \"\";\n            for (const i in headers) {\n                let item = headers[i];\n                if (item === null || item === undefined) {\n                    item = \"\";\n                }\n                else {\n                    item = String(item);\n                }\n                xhr.setRequestHeader(i, item);\n                const key = i;\n                if (key.toLowerCase() === 'content-type') {\n                    type = item;\n                }\n            }\n            data = simrequ ? null : convertData(data, type, xhr);\n        }\n        else {\n            data = simrequ ? null : convertData(data, \"\", xhr);\n        }\n        /* 处理 timeout */\n        xhr.timeout = timeout || 0;\n        /* 发送请求 */\n        // xhr.send()\n    });\n};\nexport { ContentType, getUrlParam, getHeaders, ajax as default };\n//# sourceMappingURL=index.js.map","import ajax, { getUrlParam, getHeaders, ContentType } from \"./index\";\nObject.assign(ajax, {\n    getUrlParam,\n    getHeaders,\n    ContentType\n});\nexport default ajax;\n//# sourceMappingURL=index.umd.js.map"],"names":["i","e","t","r","push","encodeURIComponent","n","join","ResType","ContentType","bodySet","Set","getUrlParam","url","data","paramsString","queryString","indexOf","convertData","type","xhr","has","Object","prototype","toString","call","includes","JSON","stringify","formData","FormData","append","setRequestHeader","json","getHeaders","arg","headers","arr","trim","split","item","parts","ajax","args","Promise","resolve","reject","XMLHttpRequest","addEventListener","ev","console","log","getAllResponseHeaders","ajaxRequest","request","config","response","status","statusText","uploadProgress","upload","downloadProgress","method","params","timeout","responseType","withCredentials","toUpperCase","simrequ","open","undefined","String","toLowerCase","assign"],"mappings":"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","x_google_ignoreList":[0]}